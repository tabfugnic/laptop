#!/bin/bash

source lib/utils.sh

trap 'ret=$?; test $ret -ne 0 && printf "failed\n\n" >&2; exit $ret' EXIT

set -e

working_directory=`pwd`

# Check ssh key
if [ ! -f ~/.ssh/id_rsa.pub ]; then
    error_echo "Setup ssh key before continuing"
    exit 1
fi

# Check pgp key
if [ ! -f ~/.gnupg/pubring.kbx ] && [ ! -f ~/.gnupg/pubring.gpg ]; then
    error_echo "Setup pgp key before continuing"
    exit 1
fi

# Root User
cd $working_directory
sudo -u root bash ./debian.root

# Home User
cd $working_directory
bash ./debian.local

# Cleanup
$HOME/bin/i3exit reboot
